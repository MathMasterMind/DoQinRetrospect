import argparse
from scapy.all import IP, UDP, send
import binascii

# Command-line argument parsing
parser = argparse.ArgumentParser(description="Send a QUIC initial packet to the specified target.")
parser.add_argument("target_ip", help="The IP address of the target (e.g., AdGuard, Cloudflare).")
args = parser.parse_args()

# QUIC target (from command-line argument)
target_ip = args.target_ip
target_port = 853  # QUIC typically over this custom port

# Hex dump from initial to adguard.
quic_initial_hex = """
c500000001122e14576198a0e401b9de5101e983eae5ec5f000044c80abe540661e5d8505cbc33ecc6b4ba90958b53f9033479133b2a42adf073e07cec839615ac096816a6db48e8e20d8cc2ee5c5ca19feadc800e34d35383920ae0a3da83e016dec06464275714e41ebf2bf21a114f8ad02e87cfeeb4df0d9cf35a2327644457c175ace11e70d934d43427b8ccabbcf494ae1f30010bffd38c93a1ea8771eac2154d552d211884cb648ccfaab5581e01730d3c67b6cc191261a22d91c851a7ca7d3daa0614df8a940223a6fbae3aac45ea1ba16286b482f146da75402a8870a2afe377c8fea9b0063c4a51c87670d2de0616004a9e0abd94d0541da1e2c987a7115266beb71c5bf406ae5718521c8e42b3373aaa9cdc1bea651b9aee64a7e3041da7097b3865e36f03044562f280581ed34c33e41ffe862888ce90a6edc292f35cdf25aab34c667f7418cd042548ae7de8bade6ff4c3dddf7cc98b17ec1da049b87c451dd5fde28e69f7a565442fb3ccf801acd53b0e553d6d600a197074f3b06a0f8af3a328b1acbd00fdca00b50120001adb6a24e4de5aecb309d31cf1a404881a65281033049fc7c15bc389d16af3b894744b1084caa7fa245ccbd9cd9add70385262c70adc5dfdaa6bd0a2b3dfc75d59e3aeba7073d655a0cee7bf07f0af406230d3c1b830d439943ea5f5b75830890590d029ac52c06f924cae3a703535bb3e39617dedd93c0ed8e100520b7f31e4cb2804edd1be4eaa38f259611c306d5e81a72d972418e7967280472cdeea63617da060d758c6f980e766482168f98ea6c69a9602df95890563c4c5ce43eabf314b0e2054186bea1b07ddfdead8a0d9cb45158b1e415ba2540efbfd42ea4aaffe521a8ec7c7d0f2079f62bc32d885c3c8ff2433095dc0702e47bf81a7401d00818c0c0672cb3cdddbb3c721489f0e532fa1ce64b60c525b2bf4df22a55e460e8fa7130fe9dbea7916930b6d7c2e32217455fbb14ecf4694a99344470b531fbf3c2b6904c862c53c1725fbda3d00d7d18eab82ac7bf411f43cd7bde3725f6277b3c10938b42293d7f6d31c7b0caaa6c808c1fa23ba3c8596a238c1a3876e266aacef94c0beecc9733efccc457a4bb54c0513b2b7f03b95e1a09b871b53cdf35bd1b5660afe72ee45499b22c1550bd493d5a775043a4866aceb2221e2ea2bc577e804bae74a1401aafbf318afab3d1055a34abf319427a332b3815224821b9267c66b6513d9a031991bca72aa2277ecf3ea825cfef7927c8b593fa1510c1fa52939e1d91c8421ab808d9c2834e902b5c63d5adb2b2accd8cad06ca54cd11e8099d7d3a7d70ee07b4622ad5e51ae84361e650b3b8c1454501284de3ff698ba9c60b2bed05e772b0d39cce400af30fb2dc2f84807b3dc44220149c269ffda9c76bb0491c977545b0e836e395a9814619b33bb8b5748caa4df1eada76af59d8baae6501bd5e516231f161910aef57925493621543287a9e799727075adbb2b620b7c314bdc1411b8f65ca8b4e99508fd76f0e1c8976dfcfc1276b595e3a1f27f65152a43bdd0ba96e0498051424db78a44669b867ea190decbac767173ab1d62bdf723be64b7849eba219b3407080e78cd7718270ca1c7b5f208e77c40a263f39b352c6904a23a9a12f9d8a6e2d016ebee6512d0a5f6325d820bff916c1afd1687a2ea979d2bdea38388f8ad84b9806c07a84264e168e40ac3c61835008dcf646f89fc6263028e5308aca6106b8f5550331568930d
"""

# Convert hex string to bytes
quic_initial = bytes.fromhex(quic_initial_hex.replace('\n', '').replace(' ', ''))

# Build and send the UDP packet
ip = IP(dst=target_ip)
udp = UDP(sport=12345, dport=target_port, len=8 + len(quic_initial))

packet = ip / udp / quic_initial

send(packet, verbose=1)